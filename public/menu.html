<link rel="stylesheet" href="../css/style.css">

<header class="menu-header">
  <div class="logo">
    <h1>Cook Tail</h1>
  </div>
  <nav class="menu-nav">
    <ul>
      <li><a href="../cocktails/cocktails.html">Cocktails propos√©s</a></li>
      <li id="auth-btn">
        <a href="../login.html">Connexion</a>
      </li>
      <li id="account-btn" style="display: none;"> <!-- Bouton "G√©rer mon espace" -->
        <a href="../account.html" class="account" aria-label="G√©rer mon espace">
          <span class="icon">‚öôÔ∏è</span> G√©rer mon espace
        </a>
      </li>
      <li id="logout-btn" style="display: none;"> <!-- Bouton "D√©connexion" -->
        <a href="#" onclick="logout()" aria-label="D√©connexion">
          <span class="icon">üö™</span> D√©connexion
        </a>
      </li>
    </ul>
  </nav>
</header>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  // V√©rifier l'√©tat de connexion de l'utilisateur
  async function checkLoginStatus() {
    try {
      const response = await fetch('/api/users/status');
      if (response.ok) {
        const { isAuthenticated } = await response.json();
        toggleAuthButtons(isAuthenticated);
        if (isAuthenticated) {
          socket.emit('userLoggedIn'); // Notifie les autres utilisateurs
        }
      } else {
        toggleAuthButtons(false);
      }
    } catch (error) {
      console.error('Erreur lors de la v√©rification de l\'√©tat de connexion:', error);
    }
  }

  // Basculer l'affichage des boutons
  function toggleAuthButtons(isAuthenticated) {
    const authBtn = document.getElementById('auth-btn');
    const accountBtn = document.getElementById('account-btn');
    const logoutBtn = document.getElementById('logout-btn');

    if (isAuthenticated) {
      authBtn.style.display = 'none';
      accountBtn.style.display = 'inline-block';
      logoutBtn.style.display = 'inline-block';
    } else {
      authBtn.style.display = 'inline-block';
      accountBtn.style.display = 'none';
      logoutBtn.style.display = 'none';
    }
  }

  // Fonction de d√©connexion
  async function logout() {
    try {
      const response = await fetch('/api/users/logout', { method: 'POST' });
      if (response.ok) {
        alert('Vous avez √©t√© d√©connect√©.');
        toggleAuthButtons(false);
        window.location.href = '../index.html'; // Redirection vers l'accueil
      } else {
        alert('Une erreur est survenue lors de la d√©connexion.');
      }
    } catch (error) {
      console.error('Erreur lors de la d√©connexion:', error);
    }
  }

  // Gestion des notifications Socket.IO
  socket.on('notification', (message) => {
    console.log('Notification re√ßue :', message);
  });

  // V√©rifier l'√©tat de connexion au chargement
  checkLoginStatus();
</script>
